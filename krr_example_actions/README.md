# Retail Store Skills

This repository contains a set of skills for the course Knowledge Representation and Reasoning (KRR).

## Environment
We only used the PDDL solver and our TypeDB database. 
Therefore there is no need to use the singularity to run the simulation.
To install the dependencies we used in the project, we reccomend using a conda environment.
We added a environment.yml file to the repository.
To create the environment, run the following commands in the root folder of the repository:

```bash
cd TypeDB
conda env create -f environment_linux.yml
conda activate KRR
```

## Install

### TypeDB
Our project uses TypeDB as a Knowledge Base.
Please install TypeDB according to the instructions on the [TypeDB website](https://vaticle.com/docs/typedb/2.1/get-started.html)


### Clone repo + dependencies
```bash
# Create a catkin workspace
mkdir -p project_noetic_ws/src
cd project_noetic_ws/src

# Clone this repository
git clone git@gitlab.tudelft.nl:cor/ro47014/2022_course_projects/group_04/retail_store_skills.git

# Clone dependencies for tag detection.
git clone https://github.com/AprilRobotics/apriltag.git
git clone https://github.com/AprilRobotics/apriltag_ros.git


# Create a catkin workspace with the name "project_melodic_ws" or pass the argument rosplan_ws="<your ws name>/" (main.py-62) to solve_pddl
mkdir -p project_melodic_ws/src
cd project_melodic_ws/src

# Clone ROSPlan
git clone https://github.com/KCL-Planning/ROSPlan.git

# Before building ROSPlan, run this to make sure you have all the [ROSPlan](https://github.com/KCL-Planning/ROSPlan) dependencies
sudo apt install flex bison freeglut3-dev libbdd-dev python-catkin-tools ros-$ROS_DISTRO-tf2-bullet

```

## How to run

### Start TypeDB server
in a separate terminal:
```bash
typedb server
```

### Run the simulation
To run the simulation, run the following command in the root folder of the workspace containing the `retail_store_skills` package:
```bash
cd src/retail_store_skills/TypeDB/
python3 main.py 
```

#### Specifying the solver path
The simulation uses the ROSPlan solver to solve the autogenerated PDDL problems.
It is assumed that the workspace containing the rosplan package is called "project_melodic_ws", and that the workspace is located in the same directory as the workspace containing the `retail_store_skills` package.

If this is not the case, you can pass the argument `--rosplan_ws=$HOME/path/to/rosplan_ws` to the `main.py` script, meaning you would run
```bash
cd src/retail_store_skills/TypeDB/
python main.py --rosplan_ws=$HOME/path/to/rosplan_ws
```

